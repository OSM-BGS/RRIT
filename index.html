<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RRIT – Rapid Risk Identification Tool</title>

  <!-- GCWeb and WET-BOEW styles -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/wet-boew/themes-cdn@4.0.27-theme-gcweb/css/theme.min.css" /> <!-- citeturn2search0 -->
</head>
<body>
  <header role="banner" id="wb-bnr">
    <!-- Standard Canada.ca header omitted for brevity -->
  </header>

  <main class="container" id="wb-cont">
    <div class="lang-toggle section">
      <label for="lang">Language / Langue:
        <select id="lang" onchange="toggleLanguage(this.value)">
          <option value="en" selected>English</option>
          <option value="fr">Français</option>
        </select>
      </label>
    </div>

    <div class="progress-bar section">
      <div class="progress-bar-fill" id="progressFill"></div>
    </div>

    <form id="rritForm" novalidate>
      <!-- Existing risk identification sections (A–K) go here unchanged -->

      <!-- Feedback and Report export section -->
      <section class="section" id="feedback-export">
        <h2>Feedback and Export</h2>
        <!-- Feedback form -->
        <div class="response-group">
          <label for="userFeedback" class="question-label">Your feedback on this tool:</label><br />
          <textarea id="userFeedback" rows="4" class="gc-input" placeholder="Enter your comments here..."></textarea>
          <button type="button" class="gc-button" onclick="submitFeedback()">Submit Feedback</button>
        </div>

        <!-- Export buttons -->
        <div class="response-group">
          <button type="button" class="gc-button" onclick="downloadReport()">Download Report</button>
          <button type="button" class="gc-button" onclick="printReport()">Print Report</button>
        </div>
      </section>
    </form>
  </main>

  <footer role="contentinfo" id="wb-info">
    <!-- Standard Canada.ca footer omitted for brevity -->
  </footer>

  <!-- Core scripts for GCWeb and WET-BOEW -->
  <script src="https://cdn.jsdelivr.net/gh/wet-boew/themes-cdn@4.0.27-wet-boew/js/wet-boew.min.js"></script> <!-- citeturn2search0 -->
  <script src="https://cdn.jsdelivr.net/gh/wet-boew/themes-cdn@4.0.27-theme-gcweb/js/theme.min.js"></script> <!-- citeturn2search0 -->

  <!-- Custom script for report generation, download, print, and feedback -->
  <script>
    function collectAnswers() {
      const data = {};
      // Collect radio inputs for each question
      document.querySelectorAll('input[type="radio"]').forEach(r => {
        if (r.checked) {
          data[r.name] = r.value;
        }
      });
      data.timestamp = new Date().toISOString();
      return data;
    }

    function generateReportHTML(data) {
      let html = '<!DOCTYPE html><html><head><title>RRIT Report</title></head><body>';
      html += '<h1>RRIT Results</h1>';
      html += '<p><strong>Generated:</strong> ' + data.timestamp + '</p>';
      html += '<ul>';
      Object.keys(data).forEach(key => {
        if (key !== 'timestamp') {
          html += '<li><strong>' + key + ':</strong> ' + data[key] + '</li>';
        }
      });
      html += '</ul>';
      html += '</body></html>';
      return html;
    }

    function downloadReport() {
      const data = collectAnswers();
      const blob = new Blob([generateReportHTML(data)], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'RRIT-report.html';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    }

    function printReport() {
      const data = collectAnswers();
      const reportWindow = window.open('', '_blank');
      reportWindow.document.write(generateReportHTML(data));
      reportWindow.document.close();
      reportWindow.focus();
      reportWindow.print();
      reportWindow.close();
    }

    function submitFeedback() {
      const feedback = document.getElementById('userFeedback').value;
      if (!feedback) {
        alert('Please enter your feedback.');
        return;
      }
      // Here, integrate with a feedback endpoint or email link
      alert('Thank you for your feedback!');
      document.getElementById('userFeedback').value = '';
    }
  </script>
</body>
</html>
